/**
 * An Angular module that gives you access to the browsers local storage
 * @version v0.2.8 - 2016-07-14
 * @link https://github.com/grevory/angular-local-storage
 * @author grevory <greg@gregpike.ca>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(n,t){var f=t.isDefined,r=t.isUndefined,e=t.isNumber,i=t.isObject,o=t.isArray,s=t.extend,u=t.toJson;t.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls";this.storageType="localStorage";this.cookie={expiry:30,path:"/"};this.defaultToCookie=!0;this.notify={setItem:!0,removeItem:!1};this.setPrefix=function(n){return this.prefix=n,this};this.setStorageType=function(n){return this.storageType=n,this};this.setDefaultToCookie=function(n){return this.defaultToCookie=!!n,this};this.setStorageCookie=function(n,t){return this.cookie.expiry=n,this.cookie.path=t,this};this.setStorageCookieDomain=function(n){return this.cookie.domain=n,this};this.setNotify=function(n,t){return this.notify={setItem:n,removeItem:t},this};this.$get=["$rootScope","$window","$document","$parse","$timeout",function(n,t,h,c,l){function ct(i){if(i||(i=t.event),g.setItem&&at(i.key)){var r=ft(i.key);l(function(){n.$broadcast("LocalStorageModule.notification.changed",{key:r,newvalue:i.newValue,storageType:a.storageType})})}}var a=this,v=a.prefix,d=a.cookie,g=a.notify,w=a.storageType,p,lt;h?h[0]&&(h=h[0]):h=document;v.substr(-1)!=="."&&(v=!v?"":v+".");var b=function(n){return v+n},ft=function(n){return n.replace(new RegExp("^"+v,"g"),"")},at=function(n){return n.indexOf(v)===0},et=function(){try{var i=w in t&&t[w]!==null,r=b("__"+Math.round(Math.random()*1e7));return i&&(p=t[w],p.setItem(r,""),p.removeItem(r)),i}catch(u){return a.defaultToCookie&&(w="cookie"),n.$broadcast("LocalStorageModule.notification.error",u.message),!1}},y=et(),it=function(t,i,f){if(k(f),i=r(i)?null:u(i),!y&&a.defaultToCookie||a.storageType==="cookie")return y||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),g.setItem&&n.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:i,storageType:"cookie"}),nt(t,i);try{p&&p.setItem(b(t),i);g.setItem&&n.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:i,storageType:a.storageType})}catch(e){return n.$broadcast("LocalStorageModule.notification.error",e.message),nt(t,i)}return!0},ot=function(t,i){if(k(i),!y&&a.defaultToCookie||a.storageType==="cookie")return y||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),ht(t);var r=p?p.getItem(b(t)):null;if(!r||r==="null")return null;try{return JSON.parse(r)}catch(u){return r}},st=function(){var r=0,i,t;for(arguments.length>=1&&(arguments[arguments.length-1]==="localStorage"||arguments[arguments.length-1]==="sessionStorage")&&(r=1,k(arguments[arguments.length-1])),i=0;i<arguments.length-r;i++)if(t=arguments[i],!y&&a.defaultToCookie||a.storageType==="cookie")y||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),g.removeItem&&n.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"}),tt(t);else try{p.removeItem(b(t));g.removeItem&&n.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:a.storageType})}catch(u){n.$broadcast("LocalStorageModule.notification.error",u.message);tt(t)}},vt=function(t){var i,r,u;if(k(t),!y)return n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];i=v.length;r=[];for(u in p)if(u.substr(0,i)===v)try{r.push(u.substr(i))}catch(f){return n.$broadcast("LocalStorageModule.notification.error",f.Description),[]}return r},yt=function(t,i){var f,e,u,r;if(k(i),f=!v?new RegExp:new RegExp("^"+v),e=!t?new RegExp:new RegExp(t),!y&&a.defaultToCookie||a.storageType==="cookie")return y||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),ut();if(!y&&!a.defaultToCookie)return!1;u=v.length;for(r in p)if(f.test(r)&&e.test(r.substr(u)))try{st(r.substr(u))}catch(o){return n.$broadcast("LocalStorageModule.notification.error",o.message),ut()}return!0},rt=function(){try{return t.navigator.cookieEnabled||"cookie"in h&&(h.cookie.length>0||(h.cookie="test").indexOf.call(h.cookie,"test")>-1)}catch(i){return n.$broadcast("LocalStorageModule.notification.error",i.message),!1}}(),nt=function(t,f,s){var v;if(r(f))return!1;if((o(f)||i(f))&&(f=u(f)),!rt)return n.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var l="",c=new Date,a="";f===null?(c.setTime(c.getTime()+-864e5),l="; expires="+c.toGMTString(),f=""):e(s)&&s!==0?(c.setTime(c.getTime()+s*864e5),l="; expires="+c.toGMTString()):d.expiry!==0&&(c.setTime(c.getTime()+d.expiry*864e5),l="; expires="+c.toGMTString());!t||(v="; path="+d.path,d.domain&&(a="; domain="+d.domain),h.cookie=b(t)+"="+encodeURIComponent(f)+l+v+a)}catch(y){return n.$broadcast("LocalStorageModule.notification.error",y.message),!1}return!0},ht=function(t){var u,r,i,f;if(!rt)return n.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(u=h.cookie&&h.cookie.split(";")||[],r=0;r<u.length;r++){for(i=u[r];i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(b(t)+"=")===0){f=decodeURIComponent(i.substring(v.length+t.length+1,i.length));try{return JSON.parse(f)}catch(e){return f}}}return null},tt=function(n){nt(n,null)},ut=function(){for(var r,n=null,u=v.length,i=h.cookie.split(";"),t=0;t<i.length;t++){for(n=i[t];n.charAt(0)===" ";)n=n.substring(1,n.length);r=n.substring(u,n.indexOf("="));tt(r)}},pt=function(){return w},k=function(n){return n&&w!==n&&(w=n,y=et()),y},wt=function(n,t,r,u,e){u=u||t;var o=ot(u,e);return o===null&&f(r)?o=r:i(o)&&i(r)&&(o=s(o,r)),c(t).assign(n,o),n.$watch(t,function(n){it(u,n,e)},i(n[t]))};return y&&(t.addEventListener?t.addEventListener("storage",ct,!1):t.attachEvent&&t.attachEvent("onstorage",ct)),lt=function(n){var r,u,i;for(k(n),r=0,u=t[w],i=0;i<u.length;i++)u.key(i).indexOf(v)===0&&r++;return r},{isSupported:y,getStorageType:pt,setStorageType:k,set:it,add:it,get:ot,keys:vt,remove:st,clearAll:yt,bind:wt,deriveKey:b,underiveKey:ft,length:lt,defaultToCookie:this.defaultToCookie,cookie:{isSupported:rt,set:nt,add:nt,get:ht,remove:tt,clearAll:ut}}}]})})(window,window.angular);